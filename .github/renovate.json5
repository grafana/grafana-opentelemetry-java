{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "branchPrefix": "grafanarenovatebot/",
  "platformCommit": true,
  "dependencyDashboard": false,
  "forkProcessing": "enabled",
  "rebaseWhen": "behind-base-branch",
  "packageRules": [
    {
      "matchUpdateTypes": [
        "major"
      ],
      "labels": [
        "update-major"
      ]
    },
    {
      "matchUpdateTypes": [
        "minor"
      ],
      "labels": [
        "update-minor"
      ]
    },
    {
      "matchUpdateTypes": [
        "patch"
      ],
      "labels": [
        "automerge-patch"
      ]
    },
    {
      "matchUpdateTypes": [
        "digest"
      ],
      "labels": [
        "update-digest"
      ],
    },
    {
      // keep spring 2 examples
      "matchFileNames": [
        "examples/**/build.gradle",
      ],
      "matchPackagePrefixes": [
        "org.springframework.boot:",
        "io.spring.dependency-management",
        "redis.clients:"
        // spring 2 examples can't use the next major version
      ],
      "matchUpdateTypes": [
        "major"
      ],
      "enabled": false
    },
    {
      "matchFileNames": [
        "examples/**/build.gradle",
      ],
      "labels": [
        "oats"
      ],
      "groupName": "examples"
    }
  ],
  "vulnerabilityAlerts": {
    "enabled": true,
    "labels": [
      "automerge-security-update"
    ]
  },
  "osvVulnerabilityAlerts": true,
  customManagers: [
    {
      // Update renovate version in GHA workflow file.
      "customType": "regex",
      "depNameTemplate": "ghcr.io/renovatebot/renovate",
      "datasourceTemplate": "docker",
      "fileMatch": [
        "^\\.github/workflows/.*\\.ya?ml$",
      ],
      "matchStrings": [
        "renovate-version: (?<currentValue>[^@\\s]+)(?:@(?<currentDigest>\\S+))?",
        "RENOVATE_IMAGE=ghcr.io/renovatebot/renovate:(?<currentValue>[^@\\s]+)(?:@(?<currentDigest>\\S+))?"
      ]
    },
    {
      "customType": "regex",
      "description": "Update _VERSION variables in Dockerfiles",
      "fileMatch": [
        "(^|/|\\.)Dockerfile$",
        "(^|/)Dockerfile\\.[^/]*$"
      ],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>[a-z-]+?)(?: depName=(?<depName>.+?))? packageName=(?<packageName>.+?)(?: versioning=(?<versioning>[a-z-]+?))?\\s(?:ENV|ARG) .+?_VERSION=(?<currentValue>.+?)\\s"
      ]
    },
    {
      "customType": "regex",
      "description": "Update release in run-example.sh",
      "depNameTemplate": "grafana/grafana-opentelemetry-java",
      "datasourceTemplate": "github-releases",
      "fileMatch": [
        "^examples/run-example.sh$",
      ],
      "matchStrings": [
        "RELEASE=(?<currentValue>[^\\s]+)"
      ]
    }
  ]
}
